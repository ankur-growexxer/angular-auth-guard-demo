<app-navbar></app-navbar>
<h2 class="mt-3">Product Management</h2>
<form #productForm="ngForm" (ngSubmit)="addProduct()" novalidate>
  <div class="mb-3 row g-2">
    <div class="col-md-4">
      <input
        class="form-control"
        name="name"
        [(ngModel)]="newProduct.name"
        placeholder="Name"
        required
        minlength="3"
        #name="ngModel"
      >
      <div *ngIf="name.invalid && name.touched" class="text-danger small">
        <span *ngIf="name.errors?.['required']">Name is required.</span>
        <span *ngIf="name.errors?.['minlength']">Name must be at least 3 characters long.</span>
      </div>
    </div>

    <div class="col-md-4">
      <input
        class="form-control"
        name="price"
        [(ngModel)]="newProduct.price"
        placeholder="Price"
        type="number"
        required
        min="1"
        #price="ngModel"
      >
      <div *ngIf="price.invalid && price.touched" class="text-danger small">
        <span *ngIf="price.errors?.['required']">Price is required.</span>
        <span *ngIf="price.errors?.['min']">Price must be greater than 0.</span>
      </div>
    </div>

    <div class="col-md-2">
      <button
        type="submit"
        class="btn btn-primary w-100"
        [disabled]="productForm.invalid"
      >
        Add
      </button>
    </div>
  </div>
</form>

<div class="mb-3">
  <input
    type="text"
    class="form-control"
    placeholder="Search by any field..."
    [(ngModel)]="searchText"
    name="search"
  >
</div>

<hr>

<table class="table table-bordered table-striped">
  <thead class="table-dark">
    <tr>
      <th>Name</th>
      <th>Price</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let p of filteredProducts()">
      <ng-container *ngIf="editingProduct?.id !== p.id; else editRow">
        <td>{{ p.name }}</td>
        <td>{{ p.price }}</td>
        <td>
          <button class="btn btn-sm btn-warning me-1" (click)="editProduct(p)">Edit</button>
          <button class="btn btn-sm btn-danger" (click)="deleteProduct(p.id)">Delete</button>
        </td>
      </ng-container>
    </tr>

    <ng-template #editRow>
      <td>
        <input
          class="form-control"
          [(ngModel)]="editingProduct.name"
          name="editName"
          required
          minlength="3"
          #editName="ngModel"
        >
        <div *ngIf="editName.invalid && editName.touched" class="text-danger small">
          <span *ngIf="editName.errors?.['required']">Name is required.</span>
          <span *ngIf="editName.errors?.['minlength']">Name must be at least 3 characters long.</span>
        </div>
      </td>
      <td>
        <input
          class="form-control"
          [(ngModel)]="editingProduct.price"
          name="editPrice"
          type="number"
          required
          min="1"
          #editPrice="ngModel"
        >
        <div *ngIf="editPrice.invalid && editPrice.touched" class="text-danger small">
          <span *ngIf="editPrice.errors?.['required']">Price is required.</span>
          <span *ngIf="editPrice.errors?.['min']">Price must be greater than 0.</span>
        </div>
      </td>
      <td>
        <button
          class="btn btn-sm btn-success me-1"
          (click)="updateProduct()"
          [disabled]="editName.invalid || editPrice.invalid"
        >
          Save
        </button>
        <button class="btn btn-sm btn-secondary" (click)="editingProduct = null">Cancel</button>
      </td>
    </ng-template>
  </tbody>
</table>
